import O from"node:path";import{createPrompt as N,isBackspaceKey as Q,isDownKey as _,isEnterKey as V,isSpaceKey as X,isUpKey as w,makeTheme as Y,useKeypress as Z,useMemo as F,usePagination as ee,usePrefix as te,useState as v}from"@inquirer/core";import c from"@inquirer/figures";import i from"chalk";import R from"node:fs";import b from"node:path";var U="\x1B[?25l";function j(e){return e.name==="escape"}function T(e){return e.endsWith(b.sep)?e:`${e}${b.sep}`}function J(e){return e.replace(/\x1B\[\d+m/g,"")}function M(e){return e.reduce((n,s)=>Math.max(n,J(s).length),0)}function k(e,n){let s=R.readdirSync(e);return(n==="directory"||n==="file+directory")&&s.unshift("."),s.map(l=>{let y=b.join(e,l),D=R.statSync(y);return Object.assign(D,{name:l,path:y,isDisabled:!1})})}function B(e,n){return e.sort((s,l)=>s.isDisabled&&!l.isDisabled?1:!s.isDisabled&&l.isDisabled||s.isDirectory()&&!l.isDirectory()?-1:!s.isDirectory()&&l.isDirectory()?1:s.name.localeCompare(l.name)).filter(s=>n||!s.isDisabled)}var se={prefix:{idle:i.cyan("?"),done:i.green(c.tick),canceled:i.red(c.cross)},icon:{linePrefix:e=>e?`${c.lineUpRight}${c.line.repeat(2)} `:`${c.lineUpDownRight}${c.line.repeat(2)} `},style:{disabled:e=>i.dim(e),active:e=>i.cyan(e),cancelText:e=>i.red(e),emptyText:e=>i.red(e),directory:e=>i.yellow(e),file:e=>i.white(e),currentDir:e=>i.magenta(e),message:(e,n)=>i.bold(e),help:e=>i.white(e),key:e=>i.cyan(e)}},de=N((e,n)=>{let{type:s="file",pageSize:l=10,loop:y=!1,showExcluded:D=!1,disabledLabel:A=" (not allowed)",allowCancel:C=!1,cancelText:H="Canceled.",emptyText:q="Directory is empty."}=e,[g,K]=v("idle"),r=Y(se,e.theme),$=te({status:g,theme:r}),[h,E]=v(O.resolve(process.cwd(),e.basePath||".")),a=F(()=>{let t=k(h,s);for(let o of t)o.isDisabled=e.filter?!e.filter(o):!1;return B(t,D)},[h]),u=F(()=>{let t=a.findIndex(p=>!p.isDisabled),o=a.findLastIndex(p=>!p.isDisabled);return t===-1?{first:0,last:0}:{first:t,last:o}},[a]),[m,x]=v(u.first),f=a[m];Z((t,o)=>{if(V(t)){if(f.isDisabled||s==="file"&&f.isDirectory()||s==="directory"&&!f.isDirectory())return;K("done"),n(f.path)}else if(X(t)&&f.isDirectory())E(f.path),x(u.first);else if(w(t)||_(t)){if(o.clearLine(0),y||w(t)&&m!==u.first||_(t)&&m!==u.last){let p=w(t)?-1:1,d=m;do d=(d+p+a.length)%a.length;while(a[d].isDisabled);x(d)}}else Q(t)?(E(O.resolve(h,"..")),x(u.first)):j(t)&&C&&(K("canceled"),n("canceled"))});let L=ee({items:a,active:m,renderItem({item:t,index:o,isActive:p}){let d=o===a.length-1,P=r.icon.linePrefix(d),I=t.isDirectory()?`${P}${T(t.name)}`:`${P}${t.name}`;if(t.isDisabled)return r.style.disabled(`${I}${A}`);let G=t.isDirectory()?r.style.directory:r.style.file;return(p?r.style.active:G)(I)},pageSize:l,loop:y}),S=r.style.message(e.message,g);if(g==="canceled")return`${$} ${S} ${r.style.cancelText(H)}`;if(g==="done")return`${$} ${S} ${r.style.answer(f.path)}`;let z=r.style.currentDir(T(h)),W=F(()=>{let t=[`${r.style.key(c.arrowUp+c.arrowDown)} navigate, ${r.style.key("<enter>")} select${C?`, ${r.style.key("<esc>")} cancel`:""}`,`${r.style.key("<space>")} open directory, ${r.style.key("<backspace>")} go back`],o=M(t);return`${c.lineBold.repeat(o)}
${t.join(`
`)}`},[]);return`${$} ${S}
${z}
${L.length?L:r.style.emptyText(q)}
${W}${U}`});export{de as default};
